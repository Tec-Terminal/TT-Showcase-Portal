# Bulk Upload Courses - Implementation Summary

## Overview

The bulk upload feature for courses has been implemented on the backend. This feature allows administrators to upload a list of courses from a CSV or Excel file, similar to the student bulk upload functionality.

## What Was Implemented

### 1. DTOs (Data Transfer Objects)

**Files:**
- `src/course/dto/bulk-upload-course.dto.ts` - Main DTO for bulk upload request
- `src/course/dto/bulk-upload-course-record.dto.ts` - DTO for individual course records

**Key Fields:**
- `records` - Array of course records with:
  - `oldId` - Old Course ID from legacy system (from `_id` column in CSV)
  - `title` - Course title/name (from `title` column)
  - `duration` - Course duration in months (from `duration` column)

### 2. Service Implementation

**File: `src/course/course.service.ts`**

Added `bulkUploadCourses()` method that:
- Processes each record in a transaction
- Checks for duplicate `oldId` and course names (case-insensitive)
- Generates course code automatically using `generateCourseCode()`
- Creates courses with:
  - `type`: `TEC_TERMINAL` (default)
  - `status`: `ACTIVE`
  - `oldId`: Set from the legacy system ID
- Returns detailed results (success, failed, skipped counts and errors)

### 3. Controller Endpoint

**File: `src/course/course.controller.ts`**

Added `POST /courses/bulk-upload` endpoint:
- Protected with `@Roles(UserRole.ADMIN)` decorator
- Accepts `BulkUploadCourseDto` in request body
- Returns upload results with success/failed/skipped counts

### 4. Frontend Implementation Guide

**File: `docs/BULK_UPLOAD_COURSES_FRONTEND_GUIDE.md`**

Complete guide for frontend implementation including:
- API endpoint details
- Request/response structures
- CSV/Excel file parsing
- Data transformation
- Modal component structure
- Error handling
- Testing checklist

## Key Features

### Course Type
- All courses created via bulk upload have type set to `TEC_TERMINAL`
- This is the default type for bulk uploaded courses

### Course Status
- All courses created via bulk upload have status set to `ACTIVE`
- This differs from regular course creation which can be set to `DRAFT` or `ACTIVE`

### Course Code Generation
- Course codes are automatically generated by the backend
- Format: `TT-{INITIALS}-{SEQUENCE}` (e.g., `TT-CEH-001`)
- The code is based on the course name and type (TEC_TERMINAL)

### Duplicate Handling
- Records with duplicate `oldId` are skipped
- Records with duplicate course names (case-insensitive) are skipped
- Skipped records are returned in the response for review

### Error Reporting
- Detailed error messages for each failed record
- Row numbers for easy identification
- Reasons for skipped records

## CSV File Format

The CSV file should have the following columns (matching `CPN.courses.csv`):

```csv
_id,title,duration
66e1b6d442a23f4ad1e2a215,CERTIFIED ETHICAL HACKING (CEH),7
66e7237d718b286147ac2ec6,Digital Marketing,3
```

**Column Mapping:**
- `_id` → `oldId` (Old Course ID from legacy system)
- `title` → `title` (Course name)
- `duration` → `duration` (Course duration in months)

## Files Modified/Created

### Modified Files:
1. `src/course/course.service.ts` - Added `bulkUploadCourses()` method
2. `src/course/course.controller.ts` - Added bulk upload endpoint

### Created Files:
1. `src/course/dto/bulk-upload-course.dto.ts` - Main DTO
2. `src/course/dto/bulk-upload-course-record.dto.ts` - Record DTO
3. `docs/BULK_UPLOAD_COURSES_FRONTEND_GUIDE.md` - Frontend guide
4. `docs/BULK_UPLOAD_COURSES_IMPLEMENTATION_SUMMARY.md` - This file

## Testing

You can test the endpoint using a tool like Postman or curl:

```bash
curl -X POST http://localhost:3000/courses/bulk-upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "records": [
      {
        "oldId": "66e1b6d442a23f4ad1e2a215",
        "title": "CERTIFIED ETHICAL HACKING (CEH)",
        "duration": 7
      },
      {
        "oldId": "66e7237d718b286147ac2ec6",
        "title": "Digital Marketing",
        "duration": 3
      }
    ]
  }'
```

## Important Notes

1. **Course Type**: All bulk upload courses use `TEC_TERMINAL` type
2. **Course Status**: All bulk upload courses are created with `ACTIVE` status
3. **Course Code**: Automatically generated based on course name and type
4. **oldId**: Stored to track the ID from the legacy system
5. **Transaction Safety**: Each record is processed in its own transaction for data integrity

## Next Steps

1. **Frontend Implementation**: Follow the guide in `docs/BULK_UPLOAD_COURSES_FRONTEND_GUIDE.md` to implement:
   - Upload button
   - Modal with file upload
   - CSV/Excel file parsing
   - API integration
   - Results display

2. **Testing**: Test the endpoint with the provided CSV file (`CPN.courses.csv`) or create test data

3. **Validation**: Ensure that:
   - CSV/Excel files are parsed correctly
   - Course codes are generated correctly
   - Duplicate handling works as expected
   - Error messages are clear and helpful

## Support

If you encounter any issues:
1. Check that the CSV/Excel file has the correct column names (`_id`, `title`, `duration`)
2. Verify that `oldId` values are unique
3. Review error messages in the API response
4. Check the frontend guide for implementation details





